<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="BaseballBinder - The ultimate digital baseball card collection manager. Import checklists, track your cards, and manage your collection with ease.">
    <meta name="keywords" content="baseball cards, card collection, baseball binder, sports cards, trading cards, collection manager">
    <title>BaseballBinder - Your Digital Card Collection Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .nav-brand {
            font-size: 1.4em;
            font-weight: 800;
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand-logo {
            height: 50px;
            width: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.15));
            transition: transform 0.3s;
        }

        .brand-logo:hover {
            transform: scale(1.05);
        }

        .brand-text {
            display: flex;
            flex-direction: column;
            line-height: 1;
        }

        .brand-name {
            font-size: 1.2em;
            letter-spacing: -0.5px;
        }

        .brand-tagline {
            font-size: 0.35em;
            opacity: 0.7;
            font-weight: 500;
            margin-top: 2px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
            list-style: none;
        }

        .nav-link {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #555;
        }

        .nav-link:hover {
            background: #f0f0f0;
            color: #3a7bd5;
        }

        .nav-link.active {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Page Sections */
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Landing Page */
        .hero {
            margin-bottom: 30px;
        }

        .hero-subtitle {
            font-size: 1.5em;
            color: #555;
            font-weight: 500;
            margin-top: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }

        .stats-header {
            text-align: center;
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 10px 30px rgba(58, 123, 213, 0.3);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .action-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .action-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .action-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .action-description {
            color: #666;
            font-size: 0.95em;
        }

        /* Content Card */
        .content-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .content-card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 700;
        }

        /* Forms */
        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
            font-size: 0.9em;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #3a7bd5;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(58, 123, 213, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(58, 123, 213, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        /* File Upload */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: #2196f3;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            display: inline-block;
            transition: background 0.3s;
        }

        .file-input-label:hover {
            background: #1976d2;
        }

        .selected-files {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .upload-progress {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            display: none;
        }

        /* Imported Sets Display */
        .year-group {
            margin-bottom: 20px;
        }

        .year-header {
            font-weight: 700;
            font-size: 1.1em;
            color: #3a7bd5;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: linear-gradient(135deg, rgba(58, 123, 213, 0.1) 0%, rgba(0, 210, 255, 0.1) 100%);
            border-radius: 8px;
            display: inline-block;
        }

        .sets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-left: 20px;
        }

        .set-card {
            background: white;
            padding: 12px 16px;
            border-radius: 8px;
            border-left: 4px solid #3a7bd5;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .set-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .set-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            font-size: 0.95em;
        }

        .set-count {
            font-size: 0.85em;
            color: #666;
        }

        .no-sets-message {
            padding: 40px;
            text-align: center;
            color: #666;
            font-style: italic;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
        }

        /* Table */
        .cards-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow-x: auto;
            display: block;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .cards-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .cards-table th {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            padding: 8px 6px;
            text-align: left;
            font-weight: 600;
            font-size: 0.7em;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .cards-table td {
            padding: 6px 6px;
            border-bottom: 1px solid #eee;
            font-size: 0.75em;
            white-space: nowrap;
        }

        .cards-table tbody tr:hover {
            background: #f8f9fa;
        }

        .cards-table td.player-name {
            font-weight: 600;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cards-table td.set-name {
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cards-table td.notes-cell {
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .btn-danger-sm {
            background: #dc3545;
            color: white;
            padding: 4px 8px;
            font-size: 0.7em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-danger-sm:hover {
            background: #c82333;
        }

        /* Messages */
        .message {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        /* Variety Selector */
        .variety-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .variety-option {
            padding: 12px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-size: 0.9em;
        }

        .variety-option:hover {
            border-color: #3a7bd5;
            transform: translateY(-2px);
        }

        .variety-option.selected {
            background: #3a7bd5;
            color: white;
            border-color: #3a7bd5;
        }

        .variety-label {
            font-weight: 600;
            display: block;
            margin-bottom: 4px;
        }

        .parallel-label {
            font-size: 0.85em;
            color: #666;
        }

        .variety-option.selected .parallel-label {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: white;
            margin-top: 40px;
            opacity: 0.9;
        }

        .footer-brand {
            font-size: 1.3em;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .footer-text {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Hero enhancements */
        .hero .brand-icon {
            height: 200px;
            width: auto;
            margin-bottom: 25px;
            filter: drop-shadow(6px 6px 12px rgba(0,0,0,0.25));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .hero-header {
            background: white;
            border-radius: 16px;
            padding: 50px 40px 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin-bottom: 40px;
        }

        .hero-stats {
            background: white;
            border-radius: 16px;
            padding: 30px 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* Search Bar */
        .search-container {
            margin-bottom: 20px;
            position: relative;
        }

        .search-wrapper {
            position: relative;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            padding: 12px 45px 12px 45px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1em;
            transition: all 0.3s;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #3a7bd5;
            box-shadow: 0 0 0 3px rgba(58, 123, 213, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.1em;
        }

        .clear-search {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            display: none;
        }

        .clear-search:hover {
            color: #dc3545;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #3a7bd5;
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }

        .suggestion-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9em;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-item:hover {
            background: #f0f7ff;
        }

        .suggestion-item .player-name {
            font-weight: 600;
            color: #333;
        }

        .suggestion-item .card-count {
            font-size: 0.85em;
            color: #666;
            margin-left: 8px;
        }

        .collection-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .collection-stat-badge {
            background: linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        /* Buy Me a Coffee */
        .bmc-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #FFDD00;
            color: #000000;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95em;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(255, 221, 0, 0.3);
        }

        .bmc-button:hover {
            background: #FFED4E;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 221, 0, 0.4);
        }

        .bmc-button img {
            height: 20px;
            width: 20px;
        }

        .bmc-footer {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 221, 0, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .bmc-footer:hover {
            background: rgba(255, 221, 0, 0.3);
            transform: scale(1.05);
        }

        .support-section {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255, 221, 0, 0.1) 0%, rgba(255, 237, 78, 0.1) 100%);
            border-radius: 12px;
            border: 2px dashed rgba(255, 221, 0, 0.3);
        }

        .support-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .support-section p {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="BaseballBinder_thumbnail.png" alt="BaseballBinder Logo" class="brand-logo">
                <div class="brand-text">
                    <span class="brand-name">BaseballBinder</span>
                    <span class="brand-tagline">Digital Card Collection</span>
                </div>
            </div>
            <ul class="nav-links">
                <li class="nav-link active" onclick="showPage('home')">üè† Home</li>
                <li class="nav-link" onclick="showPage('import')">üì§ Import Checklists</li>
                <li class="nav-link" onclick="showPage('add')">‚ûï Add Cards</li>
                <li class="nav-link" onclick="showPage('collection')">üìö View Collection</li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div id="messageContainer"></div>

        <!-- HOME PAGE -->
        <div id="page-home" class="page active">
            <div class="hero">
                <!-- Logo and Subtitle Section -->
                <div class="hero-header">
                    <img src="BaseballBinderLogo.png" alt="BaseballBinder Logo" class="brand-icon">
                    <p class="hero-subtitle">Your Digital Baseball Card Collection Manager</p>
                </div>

                <!-- Stats Section -->
                <div class="hero-stats">
                    <div class="stats-header">Collection Overview</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üé¥</div>
                            <div class="stat-value" id="homeTotalCards">0</div>
                            <div class="stat-label">Total Cards</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-value" id="homeTotalValue">$0</div>
                            <div class="stat-label">Total Value</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-value" id="homeProfitLoss">$0</div>
                            <div class="stat-label">Profit/Loss</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quick-actions">
                <div class="action-card" onclick="showPage('import')">
                    <div class="action-icon">üì§</div>
                    <div class="action-title">Import Checklists</div>
                    <div class="action-description">Upload CSV files to build your reference database</div>
                </div>
                <div class="action-card" onclick="showPage('add')">
                    <div class="action-icon">‚ûï</div>
                    <div class="action-title">Add Cards</div>
                    <div class="action-description">Add new cards to your collection with auto-fill</div>
                </div>
                <div class="action-card" onclick="showPage('collection')">
                    <div class="action-icon">üìö</div>
                    <div class="action-title">View Collection</div>
                    <div class="action-description">Browse and manage your entire collection</div>
                </div>
            </div>

            <!-- Support Section -->
            <div class="support-section">
                <h3>‚òï Enjoying BaseballBinder?</h3>
                <p>Support the development and help keep BaseballBinder free for everyone!</p>
                <a href="https://buymeacoffee.com/baseballbinder" target="_blank" class="bmc-button">
                    ‚òï Buy Me a Coffee
                </a>
            </div>
        </div>

        <!-- IMPORT CHECKLISTS PAGE -->
        <div id="page-import" class="page">
            <div class="content-card">
                <h2>üì§ Import Checklists from CSV</h2>
                <p style="margin-bottom: 20px; color: #666;">Upload multiple CSV files for a specific year. Files should be named after the set (e.g., Topps-Chrome.csv)</p>

                <form id="uploadForm">
                    <div class="form-grid" style="grid-template-columns: 200px 1fr auto;">
                        <div class="form-group">
                            <label for="upload_year">Year *</label>
                            <input type="text" id="upload_year" required placeholder="e.g., 2025">
                        </div>
                        <div class="form-group">
                            <label>Select CSV Files *</label>
                            <div class="file-input-wrapper">
                                <label for="csv_files" class="file-input-label">üìÅ Choose Files</label>
                                <input type="file" id="csv_files" accept=".csv" multiple required>
                            </div>
                            <div id="selectedFiles" class="selected-files" style="display: none;"></div>
                        </div>
                        <div class="form-group" style="align-self: end;">
                            <button type="submit" class="btn btn-primary">Upload Checklists</button>
                        </div>
                    </div>
                </form>
                <div id="uploadProgress" class="upload-progress"></div>
            </div>

            <div class="content-card">
                <h2>üìö Imported Checklists</h2>
                <div id="importedSetsContainer" class="loading">Loading imported sets...</div>
            </div>
        </div>

        <!-- ADD CARDS PAGE -->
        <div id="page-add" class="page">
            <div class="content-card">
                <h2>‚ûï Add New Card to Collection</h2>
                <form id="cardForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="set_name">Set Name *</label>
                            <select id="set_name" required>
                                <option value="">Select a set...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="card_number">Card Number *</label>
                            <input type="text" id="card_number" required>
                        </div>
                        <div class="form-group">
                            <label for="player">Player *</label>
                            <input type="text" id="player" required>
                        </div>
                        <div class="form-group">
                            <label for="team">Team</label>
                            <input type="text" id="team">
                        </div>
                        <div class="form-group">
                            <label for="year">Year</label>
                            <input type="text" id="year">
                        </div>
                        <div class="form-group">
                            <label for="variety">Variety</label>
                            <input type="text" id="variety" placeholder="Base, Refractor, etc.">
                        </div>
                        <div class="form-group">
                            <label for="parallel">Parallel</label>
                            <input type="text" id="parallel" placeholder="Red, Blue, /99, etc.">
                        </div>
                        <div class="form-group">
                            <label for="numbered">Numbered</label>
                            <input type="text" id="numbered" placeholder="e.g., 25/99">
                        </div>
                        <div class="form-group">
                            <label for="graded">Graded</label>
                            <input type="text" id="graded" placeholder="PSA 10, Raw, etc.">
                        </div>
                        <div class="form-group">
                            <label for="price_paid">Price Paid ($)</label>
                            <input type="number" id="price_paid" step="0.01" value="">
                        </div>
                        <div class="form-group">
                            <label for="current_value">Current Value ($)</label>
                            <input type="number" id="current_value" step="0.01" value="">
                        </div>
                        <div class="form-group">
                            <label for="sold_price">Sold Price ($)</label>
                            <input type="number" id="sold_price" step="0.01" value="">
                        </div>
                        <div class="form-group">
                            <label for="location">Location</label>
                            <input type="text" id="location" placeholder="Binder 1, Box A, etc.">
                        </div>
                        <div class="form-group">
                            <label for="quantity">Quantity</label>
                            <input type="number" id="quantity" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-group">
                                <input type="checkbox" id="autograph">
                                Autograph
                            </label>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 15px;">
                        <label for="notes">Notes</label>
                        <input type="text" id="notes">
                    </div>
                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-primary">Add Card</button>
                        <button type="button" class="btn btn-success" onclick="autoFillFromChecklist()" style="margin-left: 10px;">üîç Auto-Fill from Checklist</button>
                    </div>
                    <div id="varietySelector" style="display: none; margin-top: 15px;"></div>
                </form>
            </div>
        </div>

        <!-- VIEW COLLECTION PAGE -->
        <div id="page-collection" class="page">
            <div class="content-card">
                <h2>üìö Your Collection</h2>

                <div class="collection-stats" id="collectionStats" style="display: none;">
                    <div class="collection-stat-badge">
                        <span id="filteredCount">0</span> cards shown
                    </div>
                    <div class="collection-stat-badge">
                        <span id="totalCollectionCount">0</span> total cards
                    </div>
                </div>

                <div class="search-container">
                    <div class="search-wrapper">
                        <span class="search-icon">üîç</span>
                        <input
                            type="text"
                            id="playerSearch"
                            class="search-input"
                            placeholder="Search by player name..."
                            autocomplete="off"
                        />
                        <button class="clear-search" id="clearSearch">‚úï</button>
                        <div class="search-suggestions" id="searchSuggestions"></div>
                    </div>
                </div>

                <div id="cardsContainer" class="loading">Loading cards...</div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        // Global state
        let allCards = [];
        let filteredCards = [];

        // Initialize
        loadStats();
        loadCards();
        loadImportedSets();
        loadSetDropdown();

        // Search functionality
        const searchInput = document.getElementById('playerSearch');
        const searchSuggestions = document.getElementById('searchSuggestions');
        const clearSearchBtn = document.getElementById('clearSearch');

        searchInput.addEventListener('input', handleSearchInput);
        searchInput.addEventListener('focus', handleSearchInput);
        clearSearchBtn.addEventListener('click', clearSearch);

        // Close suggestions when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-wrapper')) {
                searchSuggestions.style.display = 'none';
            }
        });

        function handleSearchInput(e) {
            const query = e.target.value.trim().toLowerCase();

            if (query.length === 0) {
                searchSuggestions.style.display = 'none';
                clearSearchBtn.style.display = 'none';
                displayCards(allCards);
                return;
            }

            clearSearchBtn.style.display = 'block';

            // Get unique players with card counts
            const playerMap = new Map();
            allCards.forEach(card => {
                const player = card.player;
                if (!playerMap.has(player)) {
                    playerMap.set(player, []);
                }
                playerMap.get(player).push(card);
            });

            // Filter players that match the query
            const matchingPlayers = Array.from(playerMap.entries())
                .filter(([player]) => player.toLowerCase().includes(query))
                .sort((a, b) => a[0].localeCompare(b[0]))
                .slice(0, 10); // Limit to 10 suggestions

            if (matchingPlayers.length > 0) {
                showSuggestions(matchingPlayers);
            } else {
                searchSuggestions.style.display = 'none';
                // Still filter cards for exact matches in other fields
                filterCards(query);
            }
        }

        function showSuggestions(players) {
            searchSuggestions.innerHTML = '';

            players.forEach(([player, cards]) => {
                const item = document.createElement('div');
                item.className = 'suggestion-item';
                item.innerHTML = `
                    <span class="player-name">${player}</span>
                    <span class="card-count">(${cards.length} card${cards.length > 1 ? 's' : ''})</span>
                `;
                item.addEventListener('click', () => {
                    searchInput.value = player;
                    searchSuggestions.style.display = 'none';
                    filterCards(player.toLowerCase());
                });
                searchSuggestions.appendChild(item);
            });

            searchSuggestions.style.display = 'block';
        }

        function filterCards(query) {
            filteredCards = allCards.filter(card => {
                return card.player.toLowerCase().includes(query) ||
                       card.set_name.toLowerCase().includes(query) ||
                       card.card_number.toLowerCase().includes(query) ||
                       (card.team && card.team.toLowerCase().includes(query));
            });
            displayCards(filteredCards);
        }

        function clearSearch() {
            searchInput.value = '';
            clearSearchBtn.style.display = 'none';
            searchSuggestions.style.display = 'none';
            displayCards(allCards);
        }

        // Page Navigation
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected page
            document.getElementById(`page-${pageName}`).classList.add('active');

            // Add active to clicked nav link
            event.target.classList.add('active');

            // Reload data when switching pages
            if (pageName === 'collection') {
                loadCards();
            } else if (pageName === 'home') {
                loadStats();
            }
        }

        // Handle CSV file selection display
        document.getElementById('csv_files').addEventListener('change', function(e) {
            const files = e.target.files;
            const container = document.getElementById('selectedFiles');

            if (files.length > 0) {
                container.style.display = 'block';
                container.innerHTML = `<strong>Selected files (${files.length}):</strong><br>` +
                    Array.from(files).map(f => f.name).join('<br>');
            } else {
                container.style.display = 'none';
            }
        });

        // Handle CSV upload
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const year = document.getElementById('upload_year').value.trim();
            const files = document.getElementById('csv_files').files;

            if (files.length === 0) {
                showMessage('Please select at least one CSV file', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('year', year);

            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            const progressDiv = document.getElementById('uploadProgress');
            progressDiv.style.display = 'block';
            progressDiv.innerHTML = '<p>Uploading and processing files...</p>';

            try {
                const response = await fetch(`${API_URL}/checklist/upload`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    let message = `Successfully uploaded ${result.uploaded} checklist entries from ${result.files_processed} file(s)!`;
                    if (result.errors.length > 0) {
                        message += '<br><strong>Errors:</strong><br>' + result.errors.join('<br>');
                    }
                    progressDiv.innerHTML = `<p style="color: #28a745;">${message}</p>`;
                    document.getElementById('uploadForm').reset();
                    document.getElementById('selectedFiles').style.display = 'none';
                    showMessage('Checklist uploaded successfully!', 'success');

                    // Refresh imported sets display and dropdown
                    loadImportedSets();
                    loadSetDropdown();
                } else {
                    progressDiv.innerHTML = `<p style="color: #dc3545;">Error uploading files</p>`;
                    showMessage('Error uploading files', 'error');
                }
            } catch (error) {
                progressDiv.innerHTML = `<p style="color: #dc3545;">Error connecting to server</p>`;
                showMessage('Error connecting to server', 'error');
            }
        });

        document.getElementById('cardForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const cardData = {
                set_name: document.getElementById('set_name').value.trim(),
                card_number: document.getElementById('card_number').value.trim(),
                player: document.getElementById('player').value.trim(),
                team: document.getElementById('team').value.trim() || null,
                year: document.getElementById('year').value.trim() || null,
                variety: document.getElementById('variety').value.trim() || null,
                parallel: document.getElementById('parallel').value.trim() || null,
                autograph: document.getElementById('autograph').checked,
                numbered: document.getElementById('numbered').value.trim() || null,
                graded: document.getElementById('graded').value.trim() || null,
                price_paid: document.getElementById('price_paid').value ? parseFloat(document.getElementById('price_paid').value) : null,
                current_value: document.getElementById('current_value').value ? parseFloat(document.getElementById('current_value').value) : null,
                sold_price: document.getElementById('sold_price').value ? parseFloat(document.getElementById('sold_price').value) : null,
                location: document.getElementById('location').value.trim() || null,
                notes: document.getElementById('notes').value.trim() || null,
                quantity: parseInt(document.getElementById('quantity').value) || 1
            };

            try {
                const response = await fetch(`${API_URL}/cards/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(cardData)
                });

                if (response.ok) {
                    showMessage('Card added successfully!', 'success');
                    document.getElementById('cardForm').reset();
                    document.getElementById('quantity').value = 1;
                    document.getElementById('varietySelector').style.display = 'none';
                    loadStats();
                    loadCards();
                } else {
                    showMessage('Error adding card', 'error');
                }
            } catch (error) {
                showMessage('Error connecting to server', 'error');
            }
        });

        async function loadStats() {
            try {
                const response = await fetch(`${API_URL}/stats/`);
                const stats = await response.json();

                // Update home page stats
                document.getElementById('homeTotalCards').textContent = stats.total_cards;
                document.getElementById('homeTotalValue').textContent = `$${stats.total_value.toFixed(2)}`;
                const profitLoss = stats.profit_loss;
                const profitLossEl = document.getElementById('homeProfitLoss');
                profitLossEl.textContent = `${profitLoss >= 0 ? '+' : ''}$${profitLoss.toFixed(2)}`;
                profitLossEl.style.color = profitLoss >= 0 ? '#4ade80' : '#f87171';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadCards() {
            try {
                const response = await fetch(`${API_URL}/cards/`);
                allCards = await response.json();
                filteredCards = allCards;
                displayCards(allCards);
            } catch (error) {
                document.getElementById('cardsContainer').innerHTML = '<p style="color: red;">Error loading cards</p>';
            }
        }

        function displayCards(cards) {
            const container = document.getElementById('cardsContainer');
            const statsDiv = document.getElementById('collectionStats');
            const filteredCountSpan = document.getElementById('filteredCount');
            const totalCountSpan = document.getElementById('totalCollectionCount');

            if (allCards.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No cards yet. Add your first card!</p>';
                statsDiv.style.display = 'none';
                return;
            }

            // Update stats
            filteredCountSpan.textContent = cards.length;
            totalCountSpan.textContent = allCards.length;
            statsDiv.style.display = 'flex';

            if (cards.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px; color: #666;">No cards match your search.</p>';
                return;
            }

            let html = '<div class="cards-table"><table><thead><tr>';
            html += '<th>Set</th><th>Card #</th><th>Player</th><th>Team</th><th>Year</th>';
            html += '<th>Variety</th><th>Parallel</th><th>Auto</th><th>Numbered</th><th>Graded</th>';
            html += '<th>Price Paid</th><th>Current Value</th><th>Sold Price</th>';
            html += '<th>Location</th><th>Qty</th><th>Notes</th><th>Action</th></tr></thead><tbody>';

            cards.forEach(card => {
                html += `<tr>
                    <td class="set-name" title="${card.set_name}">${card.set_name}</td>
                    <td>${card.card_number}</td>
                    <td class="player-name" title="${card.player}">${card.player}</td>
                    <td>${card.team || '-'}</td>
                    <td>${card.year || '-'}</td>
                    <td>${card.variety || '-'}</td>
                    <td>${card.parallel || '-'}</td>
                    <td style="text-align: center;">${card.autograph ? '‚úì' : '-'}</td>
                    <td>${card.numbered || '-'}</td>
                    <td>${card.graded || '-'}</td>
                    <td>$${card.price_paid ? card.price_paid.toFixed(2) : '0'}</td>
                    <td>$${card.current_value ? card.current_value.toFixed(2) : '0'}</td>
                    <td>$${card.sold_price ? card.sold_price.toFixed(2) : '0'}</td>
                    <td>${card.location || '-'}</td>
                    <td style="text-align: center;">${card.quantity}</td>
                    <td class="notes-cell" title="${card.notes || ''}">${card.notes || '-'}</td>
                    <td><button class="btn-danger-sm" onclick="deleteCard(${card.id})">Del</button></td>
                </tr>`;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        async function loadImportedSets() {
            try {
                const response = await fetch(`${API_URL}/checklist/imported-sets`);
                const data = await response.json();

                const container = document.getElementById('importedSetsContainer');

                if (Object.keys(data).length === 0) {
                    container.innerHTML = '<div class="no-sets-message">No checklists imported yet. Upload CSV files above to get started!</div>';
                    return;
                }

                let html = '';
                // Sort years in descending order
                const years = Object.keys(data).sort((a, b) => b.localeCompare(a));

                years.forEach(year => {
                    html += `<div class="year-group">
                        <div class="year-header">üìÖ ${year}</div>
                        <div class="sets-grid">`;

                    data[year].forEach(set => {
                        html += `<div class="set-card">
                            <div class="set-name">${set.set_name}</div>
                            <div class="set-count">üìä ${set.card_count} cards</div>
                        </div>`;
                    });

                    html += '</div></div>';
                });

                container.innerHTML = html;
            } catch (error) {
                document.getElementById('importedSetsContainer').innerHTML = '<p style="color: red;">Error loading imported sets</p>';
            }
        }

        async function loadSetDropdown() {
            try {
                const response = await fetch(`${API_URL}/checklist/all-sets`);
                const sets = await response.json();

                const dropdown = document.getElementById('set_name');
                const currentValue = dropdown.value;

                // Clear existing options except the first one
                dropdown.innerHTML = '<option value="">Select a set...</option>';

                // Group by year
                const grouped = {};
                sets.forEach(set => {
                    if (!grouped[set.year]) {
                        grouped[set.year] = [];
                    }
                    grouped[set.year].push(set.set_name);
                });

                // Sort years descending
                const years = Object.keys(grouped).sort((a, b) => b.localeCompare(a));

                // Add optgroups for each year
                years.forEach(year => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = `üìÖ ${year}`;

                    grouped[year].sort().forEach(setName => {
                        const option = document.createElement('option');
                        option.value = setName;
                        option.textContent = setName;
                        optgroup.appendChild(option);
                    });

                    dropdown.appendChild(optgroup);
                });

                // Restore previous selection if it still exists
                if (currentValue) {
                    dropdown.value = currentValue;
                }

                // Auto-populate year when set is selected
                dropdown.addEventListener('change', function() {
                    const selectedSet = sets.find(s => s.set_name === this.value);
                    if (selectedSet) {
                        document.getElementById('year').value = selectedSet.year;
                    }
                });
            } catch (error) {
                console.error('Error loading set dropdown:', error);
            }
        }

        async function deleteCard(id) {
            if (!confirm('Are you sure you want to delete this card?')) return;

            try {
                const response = await fetch(`${API_URL}/cards/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showMessage('Card deleted successfully', 'success');
                    loadStats();
                    loadCards();
                }
            } catch (error) {
                showMessage('Error deleting card', 'error');
            }
        }

        async function autoFillFromChecklist() {
            const setName = document.getElementById('set_name').value.trim();
            const year = document.getElementById('year').value.trim();
            const cardNumber = document.getElementById('card_number').value.trim();

            if (!setName || !year || !cardNumber) {
                showMessage('Please enter Set Name, Year, and Card Number to auto-fill', 'error');
                return;
            }

            try {
                // Get card data for this specific card number
                const cardResponse = await fetch(`${API_URL}/checklist/lookup?set_name=${encodeURIComponent(setName)}&year=${encodeURIComponent(year)}&card_number=${encodeURIComponent(cardNumber)}`);

                if (!cardResponse.ok) {
                    if (cardResponse.status === 404) {
                        showMessage('Card not found in checklist. You may need to import the checklist first.', 'error');
                    } else {
                        showMessage('Error looking up card', 'error');
                    }
                    return;
                }

                const cards = await cardResponse.json();

                // Also fetch ALL parallels from the entire set
                const allChecklistResponse = await fetch(`${API_URL}/checklist/search?query=&set_name=${encodeURIComponent(setName)}&year=${encodeURIComponent(year)}`);

                let allParallels = new Set();
                if (allChecklistResponse.ok) {
                    const allCards = await allChecklistResponse.json();
                    allCards.forEach(card => {
                        if (card.parallel) {
                            allParallels.add(card.parallel);
                        }
                    });
                }

                if (cards.length === 1 && allParallels.size === 0) {
                    // Single match and no parallels in set - auto-fill directly
                    fillCardData(cards[0]);
                    showMessage('Card data auto-filled from checklist!', 'success');
                } else {
                    // Show variety and parallel selector
                    showVarietySelector(cards, Array.from(allParallels).sort());
                    showMessage(`Found card data. Select variety and parallel.`, 'success');
                }
            } catch (error) {
                showMessage('Error connecting to server', 'error');
                console.error('Auto-fill error:', error);
            }
        }

        function fillCardData(card) {
            document.getElementById('player').value = card.player || '';
            document.getElementById('team').value = card.team || '';
            document.getElementById('variety').value = card.variety || '';
            document.getElementById('parallel').value = card.parallel || '';
            document.getElementById('varietySelector').style.display = 'none';
        }

        function showVarietySelector(cards, allParallels) {
            const selector = document.getElementById('varietySelector');
            selector.style.display = 'block';

            // Group cards by variety
            const varietyGroups = {};
            cards.forEach(card => {
                const variety = card.variety || 'Base';
                if (!varietyGroups[variety]) {
                    varietyGroups[variety] = [];
                }
                varietyGroups[variety].push(card);
            });

            // Get base card data (any card will do for player/team)
            const baseCard = cards[0];

            selector.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <p style="margin: 0 0 10px 0; font-weight: 600;">Step 1: Select Variety *</p>
                        <div id="varietyOptions" class="variety-selector"></div>
                    </div>
                    <div>
                        <p style="margin: 0 0 10px 0; font-weight: 600;">Step 2: Select Parallel (Optional)</p>
                        <div id="parallelOptions" class="variety-selector" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                </div>
            `;

            const varietyContainer = selector.querySelector('#varietyOptions');
            const parallelContainer = selector.querySelector('#parallelOptions');

            let selectedVariety = null;
            let selectedParallel = null;

            // Show variety options
            Object.keys(varietyGroups).forEach(variety => {
                const option = document.createElement('div');
                option.className = 'variety-option';
                option.textContent = variety;

                option.onclick = () => {
                    varietyContainer.querySelectorAll('.variety-option').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    selectedVariety = variety;

                    // Fill basic data
                    document.getElementById('player').value = baseCard.player || '';
                    document.getElementById('team').value = baseCard.team || '';
                    document.getElementById('variety').value = variety;

                    // Clear parallel if not selected yet
                    if (!selectedParallel) {
                        document.getElementById('parallel').value = '';
                    }
                };
                varietyContainer.appendChild(option);
            });

            // Show ALL parallels from the set
            if (allParallels.length > 0) {
                // Add "No Parallel" option first
                const noParallelOption = document.createElement('div');
                noParallelOption.className = 'variety-option';
                noParallelOption.textContent = 'No Parallel';
                noParallelOption.style.fontStyle = 'italic';
                noParallelOption.onclick = () => {
                    parallelContainer.querySelectorAll('.variety-option').forEach(o => o.classList.remove('selected'));
                    noParallelOption.classList.add('selected');
                    selectedParallel = null;
                    document.getElementById('parallel').value = '';
                };
                parallelContainer.appendChild(noParallelOption);

                // Add all parallels
                allParallels.forEach(parallel => {
                    const option = document.createElement('div');
                    option.className = 'variety-option';
                    option.textContent = parallel;

                    option.onclick = () => {
                        parallelContainer.querySelectorAll('.variety-option').forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        selectedParallel = parallel;
                        document.getElementById('parallel').value = parallel;
                    };
                    parallelContainer.appendChild(option);
                });
            } else {
                parallelContainer.innerHTML = '<p style="padding: 10px; color: #666; font-style: italic;">No parallels found in this set</p>';
            }

            // Auto-select first variety if only one
            if (Object.keys(varietyGroups).length === 1) {
                varietyContainer.querySelector('.variety-option').click();
            }
        }

        function showMessage(text, type) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="message ${type}">${text}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 3000);
        }
    </script>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-brand">
            <img src="BaseballBinder_thumbnail.png" alt="BaseballBinder Logo" style="height: 35px; vertical-align: middle; margin-right: 10px; filter: brightness(0) invert(1);">
            BaseballBinder
        </div>
        <div class="footer-text">Organize, Track, and Manage Your Baseball Card Collection</div>
        <a href="https://buymeacoffee.com/baseballbinder" target="_blank" class="bmc-footer">
            ‚òï Support BaseballBinder
        </a>
    </div>
</body>
</html>
